<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>모임 날짜 조율 캘린더</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
    }
    h1 input {
      font-size: 1.2rem;
      padding: 4px;
      border: none;
      text-align: center;
    }
    .calendar {
      display: inline-block;
      margin-top: 20px;
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      font-size: 20px;
      margin-bottom: 10px;
    }
    .weekdays, .days {
      display: grid;
      grid-template-columns: repeat(7, 40px);
      gap: 4px;
      justify-content: center;
    }
    .weekdays div {
      font-weight: bold;
      color: #333;
    }
    .days div {
      padding: 10px;
      border: 1px solid #ccc;
      cursor: pointer;
    }
    .days div.selected {
      background-color: #4CAF50;
      color: white;
    }
    .days div.today {
      border: 2px solid red;
      border-radius: 50%;
    }
    .result {
      margin-top: 25px;
      font-weight: bold;
      color: #222;
    }
    button {
      margin: 10px;
      padding: 6px 14px;
      font-size: 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- 실시간 모임명 수정 가능 -->
  <h1>모임 이름: <input type="text" id="groupName" value="친구모임" /></h1>

  <!-- 캘린더 헤더 (좌우 화살표 + 월/년도 + Today 버튼) -->
  <div class="calendar">
    <div class="header">
      <button onclick="prevMonth()">&lt;</button>
      <span id="monthYear"></span>
      <button onclick="nextMonth()">&gt;</button>
    </div>
    <button onclick="goToToday()">Today</button>

    <!-- 요일 라벨 -->
    <div class="weekdays">
      <div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div>
    </div>

    <!-- 날짜들 -->
    <div class="days" id="calendarDays"></div>
  </div>

  <!-- 결과 영역: 아무도 X 안 한 날짜 표시 -->
  <div class="result" id="result"></div>

  <script>
    // 날짜 관련 전역변수
    const today = new Date();
    let currentMonth = today.getMonth();
    let currentYear = today.getFullYear();

    const selections = {};

    function renderCalendar(month, year) {
      const monthYear = document.getElementById('monthYear');
      const daysContainer = document.getElementById('calendarDays');
      daysContainer.innerHTML = '';

      const firstDay = new Date(year, month, 1).getDay();
      const lastDate = new Date(year, month + 1, 0).getDate();

      monthYear.textContent = `${year}년 ${month + 1}월`;

      // 빈칸 채우기
      for (let i = 0; i < firstDay; i++) {
        const empty = document.createElement('div');
        daysContainer.appendChild(empty);
      }

      // 날짜 생성
      for (let day = 1; day <= lastDate; day++) {
        const date = `${year}-${month + 1}-${day}`;
        const dayDiv = document.createElement('div');
        dayDiv.textContent = day;

        // 오늘 날짜 하이라이트
        if (
          day === today.getDate() &&
          month === today.getMonth() &&
          year === today.getFullYear()
        ) {
          dayDiv.classList.add('today');
        }

        // 클릭 이벤트로 X/O 반복 선택
        dayDiv.onclick = () => {
          if (!selections[date]) selections[date] = '';
          selections[date] =
            selections[date] === 'O' ? 'X' : selections[date] === 'X' ? '' : 'O';
          updateCalendar();
        };

        daysContainer.appendChild(dayDiv);
      }

      updateCalendar();
    }

    // 캘린더 UI 갱신
    function updateCalendar() {
      const dayDivs = document.querySelectorAll('.days div');
      const allDates = Object.keys(selections);

      dayDivs.forEach((div) => {
        const day = div.textContent;
        const currentDate = `${currentYear}-${currentMonth + 1}-${day}`;
        if (selections[currentDate] === 'O') {
          div.style.backgroundColor = '#4CAF50';
          div.style.color = 'white';
        } else if (selections[currentDate] === 'X') {
          div.style.backgroundColor = '#f44336';
          div.style.color = 'white';
        } else {
          div.style.backgroundColor = '';
          div.style.color = '';
        }
      });

      // 아무도 X 안 한 날짜 필터링
      const validDays = Object.entries(selections)
        .filter(([_, v]) => v !== 'X')
        .map(([date]) => date);

      document.getElementById('result').textContent =
        validDays.length > 0
          ? `가능한 날짜: ${validDays.join(', ')}`
          : '가능한 날짜가 없습니다.';
    }

    // 달 이동 함수
    function nextMonth() {
      currentMonth++;
      if (currentMonth > 11) {
        currentMonth = 0;
        currentYear++;
      }
      renderCalendar(currentMonth, currentYear);
    }

    function prevMonth() {
      currentMonth--;
      if (currentMonth < 0) {
        currentMonth = 11;
        currentYear--;
      }
      renderCalendar(currentMonth, currentYear);
    }

    function goToToday() {
      currentMonth = today.getMonth();
      currentYear = today.getFullYear();
      renderCalendar(currentMonth, currentYear);
    }

    // 최초 실행
    renderCalendar(currentMonth, currentYear);
  </script>
</body>
</html>
